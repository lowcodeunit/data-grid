<div fxLayoutAlign=" start">
  <mat-form-field *ngIf="Config?.Features?.Filter" class="filter-field">
    <input matInput type="text" (keyup)="ApplyFilter($event.target.value)" placeholder="Filter">
  </mat-form-field>
</div>

<div fxLayout="column">
  <mat-progress-bar mode="indeterminate" *ngIf="ShowLoader"></mat-progress-bar>
  <table 
    fxFlex
    mat-table 
    matSort
    [dataSource]="dataSource"
    *ngIf="Config" 
    (matSortChange)="Sorting($event)"
    multiTemplateDataRows>
    <ng-container *ngFor="let column of Config.ColumnDefs" matColumnDef="{{ column.ColType }}">
      <th 
        mat-header-cell 
        *matHeaderCellDef 
        mat-sort-header 
        [disabled]="!column.Sortable" >

        <!--
          Show select checkbox in the header
        -->
        <mat-checkbox *ngIf="ToggleSelection(Config, column)"
                      (change)="$event ? MasterToggle() : null"
                      [checked]="selection.hasValue() && IsAllSelected()"
                      [indeterminate]="selection.hasValue() && !IsAllSelected()">
        </mat-checkbox>

        <!--
          Show the header title
        -->
        {{ column.Title }}
      </th>

      <td mat-cell *matCellDef="let item" >
        <mat-checkbox *ngIf="ToggleSelection(Config, column)"
                      (click)="$event.stopPropagation()"
                      (change)="$event ? selection.toggle(item) : null"
                      [checked]="selection.isSelected(item)">
        </mat-checkbox>

        <span *ngIf="column.ColType !== 'select'">

          <!--Toggle icons on and off-->
          <i *ngIf="column.ShowIcon" class="dg-icons" [ngClass]="column.SetIcon(item)"></i>

            <!--When adding a button to the table cell-->
            <button 
              *ngIf="column.Action && column.Action.ActionType === 'button'" 
              mat-button 
              class="margin-left-2 cursor-pointer"
              (click)="column.Action.ActionHandler(item)">
              <mat-icon>{{column.SetIcon(item)}}</mat-icon>
              <span 
                *ngIf="column.Action.ActionLabel">
                {{ column.Action.ActionLabel }}
              </span>
            </button>

            <!--When adding an href-->
            <a *ngIf="column.Action && column.Action.ActionType === 'href'"  
              style="text-decoration:none;" href="{{ column.Action.ActionHandler(item) }}" target="_blank">
              <mat-icon>{{column.SetIcon(item)}}</mat-icon>
            </a>

            <!--Toggle data value on and off and set pipes, if available-->
            <!--column.pipe value comes from columnDefinition-->
          <span *ngIf="column.ShowValue">{{ item[column.ColType] | dataPipes: column.Pipe }}</span>
        </span>
      </td>
    </ng-container>
    
    <!-- Template for details (expand) row -->
    <ng-container *ngIf="Expand" matColumnDef="expandedDetail">
      <td 
        mat-cell 
        *matCellDef="let element" 
        [attr.colspan]="displayedColumns.length">
        <div
          fxLayoutAlign="center"
          class="details-con" 
          [@detailExpand]="element.isExpanded ? 'expanded' : 'collapsed'">
            <div #dynamicComponent></div>
          <mat-list>
            <div mat-subheader>Subjects of {{element.name}}</div>
            <mat-list-item *ngFor="let subject of element.subjects">
              <div mat-line>{{subject.name}}</div>
              <div mat-line> {{subject.type}} | Grade: {{subject.grade}}</div>
            </mat-list-item>
          </mat-list>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
    <tr mat-row *matRowDef="let element; columns: displayedColumns;" 
        [ngClass]="{'details-element-row' : Expand == true}">
    </tr>

    <!-- Extra row to show detail content column -->
    <div *ngIf="Expand">
      <tr 
        mat-row 
        *matRowDef="let row; 
        columns: ['expandedDetail'];
        let odd = odd;
        let even = even"
        class="details-row"
        [ngStyle]="{'background-color': RowColors(even, odd)}"
        (click)="selection.toggle(row)">
      </tr>
    </div>
  </table>
  

  <mat-paginator
    #paginator
    *ngIf="Config?.Features?.Paginator"
    [pageSize]="Config?.Features?.Paginator.PageSize"
    [pageSizeOptions]="Config?.Features?.Paginator.PageSizeOptions"
    showFirstLastButtons>
  </mat-paginator>
</div>

